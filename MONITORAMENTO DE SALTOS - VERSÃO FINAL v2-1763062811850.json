{
  "__inputs": [],
  "__elements": {},
  "__requires": [
    {
      "type": "panel",
      "id": "gapit-htmlgraphics-panel",
      "name": "HTML graphics",
      "version": "2.2.1"
    },
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "12.2.0"
    },
    {
      "type": "panel",
      "id": "text",
      "name": "Text",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "gridPos": {
        "h": 2,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 2,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "<!DOCTYPE html>\n<html lang=\"pt-br\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Flowbix Banner</title>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap\" rel=\"stylesheet\">\n    <style>\n        html,\n        body {\n            height: 100%;\n            width: 100%;\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n            background: #0A253E;\n        }\n\n\n\n\n        /*GAUGE DO GRAFANA*/\n        flot-temp-elem {\n            color: white !important;\n        }\n\n        /*GAUGE DO GRAFANA*/\n\n\n\n\n\n        /*LEGEND LAST, MEAN ETC*/\n        .css-97ygya {\n            color: white;\n        }\n\n        /*LEGEND LAST, MEAN ETC*/\n\n\n\n\n\n\n        /* TEXTO DO STAT, OU PAINEIS E TALS */\n        .css-itdw1b-panel-container {\n            background-color: rgba(0, 0, 0, 0.2);\n            border-radius: 1.5rem;\n            color: white !important;\n        }\n\n        /* TEXTO DO STAT, OU PAINEIS E TALS */\n\n\n\n\n\n\n        /*ZABBIX PROBLEMS*/\n        .ReactTable .rt-thead.-header,\n        .panel-problems .ReactTable .rt-tr-group .rt-tr.-even {\n            border: none !important;\n            background: rgba(0, 0, 0, 0.2) !important;\n\n        }\n\n        .ReactTable .rt-thead .rt-resizable-header-content {\n            color: white;\n        }\n\n        .ReactTable .rt-tr {\n            color: white;\n        }\n\n        .panel-problems .ReactTable .rt-tr .rt-td.custom-expander i {\n            color: white !important;\n        }\n\n        .ReactTable .-pagination .-btn {\n            background: rgba(0, 0, 0, 0.2) !important;\n            color: white !important;\n            border-radius: 1rem !important;\n        }\n\n        .ReactTable .-pagination .-btn[disabled] {\n            opacity: 1 !important;\n\n        }\n\n        .ReactTable .-pagination .-pageInfo {\n            color: white !important;\n        }\n\n        .ReactTable .-pagination input,\n        .ReactTable .-pagination select {\n            color: white !important;\n            background: rgba(0, 0, 0, 0.2) !important;\n            border-radius: 1rem !important;\n        }\n\n        .panel-problems .ReactTable .rt-tr-group {\n            border: none !important;\n\n        }\n\n        /*ZABBIX PROBLEMS*/\n\n\n\n\n\n\n\n\n\n        /* PAINEIS DO GRAFANA */\n        .css-fvmsws-panel-container {\n            background: rgba(0, 0, 0, 0.2);\n            border-radius: 1.5rem;\n            color: white;\n        }\n\n        /*FIM DA SESSÃO DOS PAINEIS DO GRAFANA */\n\n\n\n\n\n\n        /* INICIO DA SESSÃO DAS ROW */\n        .css-1d3xu67-Icon {\n            fill: white !important;\n        }\n\n        .dashboard-row__title {\n            color: white !important;\n        }\n\n        .dashboard-row__panel_count {\n            font-size: 1.5rem !important;\n        }\n\n        /* FIM DA SESSÃO DAS ROW */\n\n\n\n\n\n\n        /*PAINEL TEXT DO GRAFANA*/\n        .css-7mshyc-panel-container {\n            background: rgba(0, 0, 0, 0.2);\n            border-radius: 1.5rem;\n        }\n\n        /*PAINEL TEXT DO GRAFANA*/\n\n\n\n\n\n\n        /*TITULO DE QUALQUER PAINEL DO GRAFANA */\n        .css-4sw7w0 {\n            color: rgba(255, 255, 255, 1);\n        }\n\n        .css-biljvk-panel-title {\n            background: rgba(0, 0, 0, 0.2);\n            padding-left: 0.5rem;\n            padding-right: 0.5rem;\n            border-radius: 1rem;\n        }\n\n        /*TITULO DE QUALQUER PAINEL DO GRAFANA */\n\n\n\n\n\n\n\n        /*INICIO DA SESSÃO DOS TABLE DO GRAFANA */\n\n        .css-1kfgvg7-thead {\n            color: #FFFFFF;\n            background: linear-gradient(180deg, #00E96A, #004e35);\n            //background: linear-gradient(180deg, #1f6f63 20%, #0d2b3d 90%);\n            /* Gradiente do azul claro para o azul escuro */\n            padding: 0;\n            border-radius: 1.5rem 1.5rem 0 0;\n        }\n\n        .css-119zpr0 {\n            text-transform: uppercase !important;\n        }\n\n        .css-1jj2cky-tableContentWrapper {\n            text-transform: uppercase;\n        }\n\n        .css-8fjwhi-row {\n            border: 1px solid rgba(204, 204, 220, 0.12);\n        }\n\n        .css-8fjwhi-row:last-child {\n            border-bottom: 1px solid rgba(204, 204, 220, 0.12);\n        }\n\n        .css-1jj2cky-tableContentWrapper {\n            text-transform: uppercase;\n        }\n\n\n        .css-8fjwhi-row {\n            color: rgba(255, 255, 255, 1) !important;\n            text-transform: uppercase !important;\n        }\n\n        /*FIM DA SESSÃO DO TABLE */\n\n\n\n\n\n\n\n\n        /*DIV PARA EDITAR PROPRIEDADES DO GEOMAPS */\n        .ol-viewport {\n            border-radius: 1rem !important;\n            border: 1px solid rgba(204, 204, 220, 0.25) !important;\n        }\n\n        /*DIV PARA EDITAR PROPRIEDADES DO GEOMAPS */\n\n\n\n\n\n        /*HEADER DA LEGEND DO TIME SERIES*/\n        .css-180sqb0,\n        .css-1l1pgpn {\n            text-transform: uppercase;\n        }\n\n        .css-180sqb0,\n        .css-1l1pgpn {\n            color: rgba(255, 255, 255, 1);\n        }\n\n\n        /*TEXTO DA LEGEND DO TIME SERIES*/\n\n        .css-7pp3mx-LegendLabel {\n            text-transform: uppercase;\n            color: white;\n        }\n\n        .css-14gwilc {\n            color: white !important;\n        }\n\n        /*LINHA DE MAX, LAST E MEAN(TEXTO) DA LEGEND DO TIME SERIES*/\n        .css-s2uf1z {\n            color: white;\n        }\n\n        /*ICONES DE COR DA LEGENDA DO TIME SERIES*/\n        .css-1aj5l6t {\n            width: 1rem;\n            height: 1rem;\n        }\n\n        .css-4hqpog {\n            justify-content: center !important;\n        }\n\n        /*FIM DA SESSÃO DA LEGEND DO TIME SERIES*/\n\n\n\n\n\n\n\n\n\n        /* .css-n39kqr-cellContainerOverflow {\n            color: white;\n        }\n\n        .css-2qng6u-panel-container {\n            background: rgba(0, 0, 0, 0.2);\n            border: none;\n        }\n\n        .css-11qjisw {\n            height: 100%;\n        }\n\n        .css-1i88p6p {\n            width: 100%;\n            margin: 0;\n            padding: 0rem 0rem 0rem 2rem;\n        }\n\n        .css-m0z7c1 {\n            height: 100%;\n            margin: 0;\n        }\n\n        .css-n39kqr-cellContainerOverflow {\n            color: white;\n        }\n\n        .css-18yh62t-panel-container {\n            border-radius: 1rem;\n            border: 1px solid white;\n            background-color: rgba(0, 14, 28, 1);\n            color: white;\n        }\n\n        canvas[data-zr-dom-id=\"zr_0\"] {\n            border-radius: 1rem;\n            overflow: hidden;\n            \n        }\n\n        .dashboard-row--collapsed {\n            background: rgba(0, 0, 0, 0.2);\n        } */\n\n\n\n\n\n\n\n\n        /*INICIO DA SESSÃO BUSINESS VARIABLE*/\n        .css-rebjtg-input-wrapper {\n            background: rgba(0, 0, 0, 0.2);\n            width: 100%;\n            /* Define a largura como 100% */\n            height: 100%;\n            /* Define a altura como 100% */\n            border: 0;\n            color: #FFFFFF;\n            border-radius: 2rem;\n            border: 1px solid rgba(204, 204, 220, 0.12);\n        }\n\n        /*TEXTO DO BUSINESS*/\n        .css-8nwx1l-singleValue {\n            color: #FFFFFF;\n            text-transform: uppercase;\n        }\n\n        /*HEADER LAYOUT*/\n        .css-131hug8 label {\n            color: rgba(255, 255, 255, 1);\n            text-transform: uppercase;\n            background: rgba(0, 0, 0, 0.2);\n            border-radius: 2rem;\n            padding: 1rem;\n            border: 1px solid rgba(204, 204, 220, 0.12);\n        }\n\n        /*TEXTO QUANDO A VARIAVEL É NUMERO*/\n        .css-1pc1kg0-grafana-select-multi-value-container {\n            color: rgba(255, 255, 255, 1);\n            text-transform: uppercase;\n            background: rgba(0, 0, 0, 0);\n        }\n\n        /*TEXTO \"CHOOSE\" DO BUSINESS VARIABLE*/\n        .css-1n8tjau-placeholder {\n            color: rgba(255, 255, 255, 1);\n            text-transform: uppercase;\n        }\n\n        /*FIM DA SESSÃO BUSINESS VARIABLE*/\n\n\n\n\n\n\n\n\n\n\n        /*INCIO DA SESSÃO DO HEADER */\n\n        /* Contêiner principal do banner */\n        .flowbix-banner-container {\n            background: rgba(0, 0, 0, 0.2);\n            /* Fundo preto */\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            width: 100%;\n            height: 100%;\n            position: relative;\n            border: 1px solid rgba(204, 204, 220, 0.12);\n            border-radius: 5rem;\n        }\n\n        /* Contêiner do conteúdo do banner */\n        .flowbix-banner-content {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 0.5rem;\n            color: #FFFFFF;\n            /* Texto branco */\n            width: 100%;\n            height: 100%;\n        }\n\n        /* Estilo do logo */\n        .flowbix-logo {\n            height: 2rem;\n            /* Ajuste o tamanho conforme necessário */\n            width: auto;\n        }\n\n        /* Estilo do texto */\n        .flowbix-text {\n            font-size: 2rem;\n            color: #FFFFFF;\n            /* Texto branco */\n            text-align: center;\n            display: flex;\n            align-items: center;\n            gap: 1rem;\n            /* Espaço entre o texto e o ícone */\n        }\n\n        /* Barra verde antes do texto */\n        .flowbix-divider {\n            color: #FFFFFF;\n            /* Verde Auzac */\n            font-size: 2rem;\n        }\n\n        /* Estilo do ícone de segurança */\n        .flowbix-security-icon {\n            width: 2.5rem;\n            height: auto;\n        }\n\n        /*FIM DA SESSÃO DO HEADER */\n    </style>\n</head>\n\n<body>\n    <!-- Estrutura do banner -->\n    <div class=\"flowbix-banner-container\">\n        <div class=\"flowbix-banner-content\">\n            <img src=\"https://storage.googleapis.com/flowbix-img/LogoFBX_noBck.png\" alt=\"Logo Flowbix\"\n                class=\"flowbix-logo\">\n            <span class=\"flowbix-divider\">|</span>\n            <span class=\"flowbix-text\">SALTOS AVANÇADOS\n                 <!-- <img src=\"https://img.icons8.com/?size=100&id=53419&format=png&color=FFFFFF\" alt=\"Security Icon\" class=\"flowbix-security-icon\"> Ícone de segurança embutido ao lado do texto -->\n            </span>\n        </div>\n    </div>\n</body>\n\n</html>",
        "mode": "html"
      },
      "pluginVersion": "12.2.0",
      "transparent": true,
      "type": "text"
    },
    {
      "datasource": {
        "uid": "grafana"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 15,
        "w": 24,
        "x": 0,
        "y": 2
      },
      "id": 3,
      "options": {
        "SVGBaseFix": false,
        "add100Percentage": false,
        "calcsMutation": "standard",
        "centerAlignContent": false,
        "codeData": "{\n  \"text\": \"Random text\"\n}",
        "css": "/* --- TEMA E VARIÁVEIS GLOBAIS (APENAS PARA CARDS) --- */\n.main-container {\n  max-width: 100%;\n  margin: 1rem;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n\n  /* Variáveis para consistência nos cards */\n  --card-bg-color: rgba(0, 0, 0, 0.2);\n  --card-border-color: rgba(204, 204, 220, 0.12);\n  --card-shadow-color: rgba(0, 0, 0, 0.4);\n  --text-color-primary: white;\n  --text-color-secondary: rgba(255, 255, 255, 0.85);\n  /* Branco com 85% de opacidade */\n  --accent-green: #00E96A;\n  --accent-red: #f44336;\n  --accent-orange: #ffc107;\n}\n\n.tabs {\n  margin-bottom: 20px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.5);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.main-tabs {\n  display: flex;\n}\n\n.tab-btn {\n  padding: 10px 15px;\n  cursor: pointer;\n  border: none;\n  background-color: transparent;\n  font-size: 1.2rem;\n  font-weight: bold;\n  color: white;\n  border-bottom: 2px solid transparent;\n  margin-bottom: -1px;\n}\n\n.tab-btn.active {\n  border-bottom-color: #00E96A;\n  font-weight: 600;\n  color: #00E96A;\n}\n\n.tab-btn.icon-btn {\n  padding: 10px;\n  font-size: 1.2rem;\n  margin-right: 10px;\n}\n\n.tab-content {\n  display: none;\n}\n\n.tab-content.active {\n  display: block;\n  flex-grow: 1;\n}\n\n#dashboard-view.tab-content.active {\n  display: flex;\n  flex-direction: column;\n  flex-grow: 1;\n}\n\n#history-view.tab-content.active {\n  display: flex;\n  flex-direction: column;\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- gap: 6px (Diminuído)\n*/\n#dashboard-grid {\n  display: grid;\n  flex-grow: 1;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 6px;\n  /* <-- MUDANÇA: Reduzido de 8px */\n  grid-template-rows: repeat(2, 1fr);\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- padding: 8px (Diminuído)\n*/\n.card {\n  background-color: var(--card-bg-color);\n  border-radius: 1.5rem;\n  padding: 8px;\n  /* <-- MUDANÇA: Reduzido de 10px */\n  display: flex;\n  flex-direction: column;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--card-border-color);\n}\n\n.card:hover {\n  transform: translateY(-3px);\n  box-shadow: 0 8px 16px var(--card-shadow-color);\n}\n\n.card.loading {\n  align-items: center;\n  justify-content: center;\n}\n\n.card.error {\n  border-left-color: var(--accent-red);\n}\n\n.card.highlighted {\n  border: 1px solid var(--card-border-color);\n  box-shadow: 0 0 12px var(--accent-green);\n}\n\n.card.highlighted:hover {\n  transform: translateY(-3px);\n  box-shadow: 0 8px 16px var(--card-shadow-color);\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- margin-bottom: 0 (Diminuído ao máximo)\n*/\n.card-header {\n  display: flex;\n  align-items: center;\n  margin-bottom: 0;\n  /* <-- MUDANÇA: Reduzido de 2px */\n  width: 100%;\n  justify-content: space-between;\n}\n\n.card-header-text {\n  flex-grow: 1;\n  overflow: hidden;\n  text-align: center;\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- margin-left/right: 0.3rem (Diminuído)\n- font-size: 0.9rem (Diminuído)\n*/\n.card-header-text h3 {\n  margin-left: 0.3rem;\n  /* <-- MUDANÇA */\n  margin-top: 0;\n  margin-bottom: 0;\n  margin-right: 0.3rem;\n  /* <-- MUDANÇA */\n  font-size: 0.9rem;\n  /* <-- MUDANÇA: Reduzido de 1rem */\n  font-weight: 600;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  color: var(--text-color-primary);\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- font-size: 0.65rem (Diminuído)\n*/\n.card-header-text small {\n  font-size: 0.65rem;\n  /* <-- MUDANÇA: Reduzido de 0.7rem */\n  color: var(--text-color-secondary);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: block;\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- gap: 8px (Diminuído)\n- margin-top: 2px (Diminuído)\n*/\n.card-body {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  /* <-- MUDANÇA: Reduzido de 10px */\n  margin-top: 2px;\n  /* <-- MUDANÇA: Reduzido de 4px */\n  width: 100%;\n  flex-grow: 1;\n  justify-content: center;\n}\n\n.metric-group {\n  display: flex;\n  justify-content: space-around;\n}\n\n.metric {\n  flex-basis: 50%;\n  text-align: center;\n  padding: 0 5px;\n  box-sizing: border-box;\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- font-size: 1.6rem (Diminuído)\n*/\n.metric .value {\n  font-size: 1.6rem;\n  /* <-- MUDANÇA: Reduzido de 1.8rem */\n  font-weight: 700;\n  color: var(--text-color-primary);\n  line-height: 1.2;\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- font-size: 0.6rem (Diminuído)\n*/\n.metric .label {\n  font-size: 0.6rem;\n  /* <-- MUDANÇA: Reduzido de 0.65rem */\n  color: var(--text-color-secondary);\n  text-transform: uppercase;\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- font-size: 1.6rem (Diminuído)\n*/\n.latency-group .metric .value {\n  font-size: 1.6rem;\n  /* <-- MUDANÇA: Reduzido de 1.8rem */\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- font-size: 0.6rem (Diminuído)\n*/\n.latency-group .metric .label {\n  font-size: 0.6rem;\n  /* <-- MUDANÇA: Reduzido de 0.65rem */\n}\n\n.hop-change {\n  font-size: 10px;\n  /* Leve redução */\n  margin-left: 6px;\n  /* Leve redução */\n  vertical-align: middle;\n}\n\n.hop-change.increase {\n  color: var(--accent-red);\n}\n\n.hop-change.decrease {\n  color: var(--accent-green);\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- margin-top: 4px (Diminuído)\n- padding-top: 4px (Diminuído)\n- font-size: 0.75rem (Diminuído)\n- gap: 3px (Diminuído)\n*/\n.analysis-group {\n  border-top: 1px solid var(--card-border-color);\n  margin-top: 4px;\n  /* <-- MUDANÇA: Reduzido de 6px */\n  padding-top: 4px;\n  /* <-- MUDANÇA: Reduzido de 6px */\n  font-size: 0.75rem;\n  /* <-- MUDANÇA: Reduzido de 0.8rem */\n  color: var(--text-color-primary);\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  /* <-- MUDANÇA: Reduzido de 4px */\n}\n\n.analysis-item {\n  display: flex;\n  justify-content: space-between;\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- font-size: 0.75rem (alinhado)\n*/\n.analysis-item .value {\n  font-weight: bold;\n  color: var(--text-color-primary);\n  font-size: 0.75rem;\n  /* <-- MUDANÇA: Alinhado com o .analysis-group */\n}\n\n.analysis-item .value.danger {\n  color: var(--accent-red);\n  font-weight: 700;\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- width: 28px (Diminuído)\n- height: 28px (Diminuído)\n- font-size: 15px (Diminuído)\n*/\n.logo-container {\n  width: 28px;\n  /* <-- MUDANÇA: Reduzido de 30px */\n  height: 28px;\n  /* <-- MUDANÇA: Reduzido de 30px */\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 15px;\n  /* <-- MUDANÇA: Reduzido de 16px */\n  flex-shrink: 0;\n  position: relative;\n  background-color: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(204, 204, 220, 0.12);\n}\n\n.loading-circle {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  border: 2px solid var(--card-border-color);\n  border-top-color: var(--accent-green);\n  animation: none;\n}\n\n.card.loading .loading-circle {\n  animation: spin 1s linear infinite;\n}\n\n.logo-container i {\n  position: relative;\n  z-index: 2;\n  color: var(--text-color-primary);\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- width: 28px (Diminuído)\n- height: 28px (Diminuído)\n*/\n.info-icon {\n  width: 28px;\n  /* <-- MUDANÇA: Reduzido de 30px */\n  height: 28px;\n  /* <-- MUDANÇA: Reduzido de 30px */\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  cursor: pointer;\n  background-color: rgba(255, 255, 255, 0.05);\n  transition: background-color 0.2s ease;\n  border: 1px solid rgba(204, 204, 220, 0.12);\n}\n\n/* ►►►► MODIFICADO AQUI ◄◄◄◄\n- font-size: 0.8rem (Diminuído)\n*/\n.info-icon i {\n  font-size: 0.8rem;\n  /* <-- MUDANÇA: Reduzido de 0.9rem */\n  color: var(--text-color-primary);\n  line-height: 1;\n}\n\n.info-icon:hover {\n  background-color: rgba(255, 255, 255, 0.1);\n}\n\n\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.config-section {\n  background: rgba(0, 0, 0, 0.2);\n  padding: 1rem;\n  border-radius: 1.5rem;\n  margin-bottom: 1rem;\n  border: 1px solid var(--card-border-color);\n}\n\n.form-group {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 10px;\n  align-items: center;\n}\n\n.form-group.checkbox-group {\n  margin-bottom: 15px;\n  justify-content: flex-end;\n  gap: 5px;\n}\n\n.form-group.checkbox-group label {\n  color: white;\n  cursor: pointer;\n}\n\n.form-group input:not([type=\"checkbox\"]) {\n  flex-grow: 1;\n  padding: 8px;\n  border: 1px solid var(--card-border-color);\n  border-radius: 1.5rem;\n  background-color: rgba(0, 0, 0, 0.2);\n  color: var(--text-color-primary);\n}\n\n.form-group input[type=\"checkbox\"] {\n  width: 16px;\n  height: 16px;\n  cursor: pointer;\n}\n\n\n.form-group button {\n  padding: 8px 15px;\n  border: none;\n  border-radius: 1.5rem;\n  cursor: pointer;\n  color: white;\n}\n\n.add-btn {\n  background-color: rgba(0, 233, 106, 0.8);\n  padding: 8px 15px;\n  border: none;\n  border-radius: 1.5rem;\n  cursor: pointer;\n  color: white;\n}\n\n#config-view.tab-content.active {\n  display: flex;\n  flex-direction: column;\n}\n\n#save-settings-btn {\n  margin-top: auto;\n  align-self: flex-end;\n  margin-right: 20px;\n  margin-bottom: 20px;\n  padding: 10px 20px;\n  font-size: 1rem;\n  font-weight: bold;\n}\n\n.cancel-btn {\n  background-color: var(--text-color-secondary);\n  color: white;\n  border: none;\n  padding: 8px 15px;\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n#targets-list table {\n  width: 100%;\n  border-collapse: collapse;\n}\n\n#targets-list th,\n#targets-list td {\n  padding: 10px;\n  border-bottom: 1px solid var(--card-border-color);\n  text-align: left;\n  font-size: 14px;\n}\n\n#targets-list td.actions {\n  text-align: right;\n}\n\n#targets-list button {\n  background: none;\n  border: none;\n  cursor: pointer;\n  margin-left: 10px;\n  font-size: 14px;\n}\n\n#targets-list .edit-btn {\n  color: #33a2e5;\n}\n\n#targets-list .delete-btn {\n  color: var(--accent-red);\n}\n\n.target-selector {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  padding: 10px 0;\n}\n\n.target-selector .target-btn {\n  background-color: rgba(0, 0, 0, 0.2);\n  border: 1px solid var(--card-border-color);\n  color: white;\n  font-weight: bold;\n  padding: 8px 15px;\n  border-radius: 20px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.target-selector .target-btn:hover {\n  background-color: var(--card-border-color);\n  color: var(--text-color-primary);\n}\n\n.target-selector .target-btn.active {\n  background-color: var(--accent-green);\n  color: white;\n  font-weight: bold;\n  border-color: var(--accent-green);\n  border-radius: 1.5rem;\n}\n\n.chart-container {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 20px;\n}\n\n.chart-wrapper {\n  background-color: var(--card-bg-color);\n  border-radius: 1.5rem;\n  border: 1px solid var(--card-border-color);\n  display: flex;\n  flex-direction: column;\n}\n\n.chart-wrapper h3 {\n  margin-top: 1rem;\n  font-size: 16px;\n  text-align: center;\n  color: var(--text-color-primary);\n}\n\n.chart-wrapper #hourly-chart,\n.chart-wrapper #daily-chart {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  flex-grow: 1;\n}\n\n.chart-wrapper svg {\n  max-width: 100%;\n  width: 100%;\n  height: 300px;\n}\n\n.chart-wrapper svg rect:hover {\n  opacity: 1 !important;\n}\n\n.chart-wrapper svg text {\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto,\n    \"Helvetica Neue\", Arial, sans-serif;\n}\n\n\n\n#tooltip {\n  position: fixed;\n  display: none;\n  background-color: rgba(10, 10, 10, 0.9);\n  color: var(--text-color-primary);\n  padding: 10px;\n  border-radius: 5px;\n  font-family: monospace;\n  font-size: 12px;\n  max-width: 500px;\n  pointer-events: none;\n  z-index: 10000;\n  white-space: pre;\n  border: 1px solid var(--card-border-color);\n  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);\n}\n\n.slow-hop {\n  color: var(--accent-orange);\n  font-weight: bold;\n}\n\n.results-output {\n  background-color: rgba(0, 0, 0, 0.2);\n  border: 1px solid var(--card-border-color);\n  border-radius: 1.5rem;\n  padding: 20px;\n  margin-top: 20px;\n  white-space: pre;\n  max-height: 500px;\n  overflow-y: auto;\n  overflow-x: auto;\n  color: white;\n  font-size: 1rem;\n  line-height: 1.6;\n}\n\n.search-container {\n  display: none;\n  position: relative;\n  flex-grow: 1;\n  margin-left: 1rem;\n  margin-right: 1rem;\n  margin-bottom: 0.5rem;\n  align-self: center;\n}\n\n.search-container i {\n  position: absolute;\n  left: 12px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: white;\n}\n\n#global-search-filter {\n  padding: 8px 15px 8px 35px;\n  border: 1px solid var(--card-border-color);\n  border-radius: 1.5rem;\n  background-color: rgba(0, 0, 0, 0.2);\n  color: white;\n  width: 100%;\n  box-sizing: border-box;\n  transition: all 0.2s ease;\n}\n\n#global-search-filter:focus {\n  outline: none;\n  border-color: var(--accent-green);\n  box-shadow: 0 0 8px var(--accent-green);\n}\n\n#pagination-controls-container {\n  display: none;\n  justify-content: center;\n  align-items: center;\n  gap: 5px;\n  flex-shrink: 0;\n  margin-top: 15px;\n  margin-bottom: 15px;\n}\n\n.pagination-btn {\n  background-color: rgba(0, 0, 0, 0.2);\n  border: 1px solid var(--card-border-color);\n  color: var(--text-color-primary);\n  padding: 8px 12px;\n  border-radius: 1.5rem;\n  cursor: pointer;\n  font-weight: bold;\n  font-size: 0.9rem;\n  transition: all 0.2s ease;\n}\n\n.pagination-btn:hover:not(:disabled) {\n  background-color: var(--card-border-color);\n  border-color: var(--accent-green);\n}\n\n.pagination-btn.active {\n  background-color: var(--accent-green);\n  border-color: var(--accent-green);\n  color: white;\n}\n\n.pagination-btn:disabled {\n  cursor: not-allowed;\n  opacity: 0.5;\n}",
        "dynamicData": true,
        "dynamicFieldDisplayValues": true,
        "dynamicHtmlGraphics": true,
        "dynamicProps": true,
        "html": "<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css\" />\n\n<div class=\"main-container\">\n  <div class=\"tabs\">\n\n    <div class=\"main-tabs\">\n      <button class=\"tab-btn active\" data-tab=\"dashboard\">\n        <i class=\"fa-solid fa-chart-line\"></i> Dashboard\n      </button>\n      <button class=\"tab-btn\" data-tab=\"spot-test\">\n        <i class=\"fa-solid fa-crosshairs\"></i> Teste Pontual\n      </button>\n      <button class=\"tab-btn\" data-tab=\"history\">\n        <i class=\"fa-solid fa-clock-rotate-left\"></i> Histórico\n      </button>\n    </div>\n\n    <div class=\"search-container\">\n      <i class=\"fa-solid fa-search\"></i>\n      <input type=\"text\" id=\"global-search-filter\" placeholder=\"Buscar alvo...\">\n    </div>\n    <button class=\"tab-btn icon-btn\" data-tab=\"config\">\n      <i class=\"fa-solid fa-gear\"></i>\n    </button>\n  </div>\n\n  <div id=\"dashboard-view\" class=\"tab-content active\">\n    <div id=\"dashboard-grid\"></div>\n    <div id=\"pagination-controls-container\"></div>\n  </div>\n  <div id=\"spot-test-view\" class=\"tab-content\">\n    <div class=\"config-section\">\n      <h4>Teste de Traceroute Único</h4>\n      <div class=\"form-group\">\n        <input\n          type=\"text\"\n          id=\"spot-test-target\"\n          placeholder=\"Digite o IP ou DNS do alvo\"\n        />\n        <button id=\"spot-test-btn\" class=\"add-btn\">Executar Teste</button>\n      </div>\n    </div>\n    <div class=\"config-section\">\n      <h4>Resultado</h4>\n      <pre id=\"spot-test-result\" class=\"results-output\"></pre>\n    </div>\n  </div>\n\n  <div id=\"history-view\" class=\"tab-content\">\n    <div class=\"config-section\">\n      <div id=\"history-target-selector\" class=\"target-selector\"></div>\n    </div>\n    <div class=\"chart-container\">\n      <div class=\"chart-wrapper\">\n        <div id=\"hourly-chart\"></div>\n      </div>\n      <div class=\"chart-wrapper\">\n        <div id=\"daily-chart\"></div>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"config-view\" class=\"tab-content\"></div>\n\n  <div id=\"tooltip\"></div>\n\n  <img\n    src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n    onload=\"window.startTracerouteMonitor(this)\"\n    style=\"display: none\"\n  />\n\n  <div id=\"config-template\" style=\"display: none\">\n    <div class=\"config-section\">\n      <h4>Adicionar/Editar Alvo</h4>\n      <div class=\"form-group\">\n        <input\n          type=\"text\"\n          id=\"displayName\"\n          placeholder=\"Nome de Exibição\"\n        />\n        <input type=\"text\" id=\"target\" placeholder=\"IP ou DNS\" />\n      </div>\n      <div class=\"form-group checkbox-group\">\n        <input type=\"checkbox\" id=\"highlight-target\" />\n        <label for=\"highlight-target\"\n          >Destacar e gerar histórico para este alvo</label>\n      </div>\n      <div class=\"form-group\">\n        <button id=\"add-target-btn\" class=\"add-btn\">\n          <i class=\"fa-solid fa-plus\"></i> Adicionar\n        </button>\n        <button\n          id=\"cancel-edit-btn\"\n          class=\"cancel-btn\"\n          style=\"display: none\"\n        >\n          Cancelar Edição\n        </button>\n      </div>\n    </div>\n    <div class=\"config-section\">\n      <h4>Alvos Atuais</h4>\n      <div id=\"targets-list\"></div>\n    </div>\n    <div class=\"config-section\">\n      <h4>Configurações Gerais</h4>\n      <div class=\"form-group\">\n        <label for=\"refresh-interval\">Refresh (segundos):</label>\n        <input\n          type=\"number\"\n          id=\"refresh-interval\"\n          placeholder=\"0 para desativar\"\n        />\n      </div>\n      <div class=\"form-group\">\n        <label for=\"slow-hop-threshold\">Latência Lenta (ms):</label>\n        <input type=\"number\" id=\"slow-hop-threshold\" placeholder=\"Ex: 25\" />\n      </div>\n    </div>\n    <button id=\"save-settings-btn\" class=\"add-btn\">\n      Salvar Configurações\n    </button>\n  </div>\n</div>",
        "onInit": "",
        "onInitOnResize": true,
        "onRender": "function loadCSS(id, href) {\n  if (document.getElementById(id)) return;\n  const link = document.createElement('link');\n  link.id = id;\n  link.rel = 'stylesheet';\n  link.href = href;\n  document.head.appendChild(link);\n}\nloadCSS('font-awesome-css', 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css');\n\nclass TracerouteMonitor {\n  constructor(panelElement) {\n    this.panel = panelElement;\n    this.apiUrl = \"http://154.38.189.93:3065/api\"; \n    this.tooltipData = {};\n    this.editMode = { active: false, targetId: null };\n    this.refreshIntervalId = null;\n    this.previousResults = {};\n    this.slowHopThreshold = 25;\n    this.hourlyChart = null;\n    this.dailyChart = null;\n\n    // --- Lógica de Paginação (do seu código) ---\n    this.currentPage = 1;\n    this.itemsPerPage = 8;\n    // --- Fim Paginação ---\n\n    // Flag para evitar execuções duplicadas\n    this.isTestRunInProgress = false; \n  }\n\n  // ====================================================================\n  // 1. init() - AGORA É RÁPIDO\n  // Apenas carrega configs e ativa a aba 'dashboard'.\n  // ====================================================================\n  async init() {\n    console.log(\"Monitor: Iniciando (Modo Rápido e Paginado)...\");\n    \n    // Etapa 1: Configuração (Rápido)\n    const configTemplate = this.panel.querySelector(\"#config-template\");\n    const configView = this.panel.querySelector(\"#config-view\");\n    if (configTemplate && configView) {\n      configView.innerHTML = configTemplate.innerHTML;\n    }\n    this.cacheElements();\n    this.attachEventListeners();\n    \n    // Etapa 2: Carregar Configurações (Rápido, NÃO executa testes)\n    const settings = await this.loadSettings(); \n    console.log(\"Monitor: Configurações carregadas.\");\n\n    // Etapa 3: Ativar a aba dashboard (que chama loadDashboard on-demand)\n    this.switchTab(\"dashboard\"); \n    console.log(\"Monitor: Aba Dashboard ativada, carregando esqueleto.\");\n\n    // Etapa 4: Iniciar o intervalo de REFRESH\n    if (settings && settings.refreshRate > 0) {\n        this.startInterval(settings.refreshRate);\n        console.log(`Monitor: Intervalo de refresh iniciado (${settings.refreshRate}s).`);\n    } else {\n        console.log(\"Monitor: Intervalo de refresh desativado (0s).\");\n    }\n  }\n\n  // cacheElements (Do seu código, com 'dashboardGrid' e 'paginationContainer')\n  cacheElements() {\n    this.tabs = this.panel.querySelectorAll(\".tab-btn\");\n    this.tabContents = this.panel.querySelectorAll(\".tab-content\");\n    this.dashboardView = this.panel.querySelector(\"#dashboard-view\");\n\n    // Container do grid e da paginação\n    this.dashboardGrid = this.panel.querySelector(\"#dashboard-grid\");\n    this.paginationContainer = this.panel.querySelector(\n      \"#pagination-controls-container\"\n    );\n\n    this.historyView = this.panel.querySelector(\"#history-view\");\n    this.historyTargetSelector = this.panel.querySelector(\n      \"#history-target-selector\"\n    );\n    this.historyResults = this.panel.querySelector(\"#history-results\");\n    this.targetsList = this.panel.querySelector(\"#targets-list\");\n    this.addTargetBtn = this.panel.querySelector(\"#add-target-btn\");\n    this.cancelEditBtn = this.panel.querySelector(\"#cancel-edit-btn\");\n    this.displayNameInput = this.panel.querySelector(\"#displayName\");\n    this.targetInput = this.panel.querySelector(\"#target\");\n    this.highlightInput = this.panel.querySelector(\"#highlight-target\");\n    this.tooltip = this.panel.querySelector(\"#tooltip\");\n    this.refreshIntervalInput = this.panel.querySelector(\"#refresh-interval\");\n    this.slowHopInput = this.panel.querySelector(\"#slow-hop-threshold\");\n    this.saveSettingsBtn = this.panel.querySelector(\"#save-settings-btn\");\n    this.spotTestTargetInput = this.panel.querySelector(\"#spot-test-target\");\n    this.spotTestBtn = this.panel.querySelector(\"#spot-test-btn\");\n    this.spotTestResultPre = this.panel.querySelector(\"#spot-test-result\");\n    this.searchContainer = this.panel.querySelector(\".search-container\");\n    this.searchInput = this.panel.querySelector(\"#global-search-filter\");\n    this.hourlyChartWrapper = this.panel.querySelector(\"#hourly-chart\")?.parentElement;\n    this.dailyChartWrapper = this.panel.querySelector(\"#daily-chart\")?.parentElement;\n  }\n\n  // attachEventListeners (Do seu código, sem alteração)\n  attachEventListeners() {\n    if (this.addTargetBtn) {\n      this.addTargetBtn.addEventListener(\"click\", () => {\n        this.editMode.active ? this.saveTargetChanges() : this.addTarget();\n      });\n    }\n    if (this.cancelEditBtn) {\n      this.cancelEditBtn.addEventListener(\"click\", () => this.cancelEditMode());\n    }\n    if (this.saveSettingsBtn) {\n      this.saveSettingsBtn.addEventListener(\"click\", () => this.saveSettings());\n    }\n    if (this.spotTestBtn) {\n      this.spotTestBtn.addEventListener(\"click\", () => this.runSpotTest());\n    }\n    if (this.spotTestTargetInput) {\n      this.spotTestTargetInput.addEventListener(\"keydown\", (event) => {\n        if (event.key === \"Enter\") {\n          event.preventDefault();\n          this.runSpotTest();\n        }\n      });\n    }\n    if (this.searchInput) {\n      this.searchInput.addEventListener(\"input\", () => this.filterContent());\n    }\n    this.tabs.forEach((tab) => {\n      tab.addEventListener(\"click\", () => {\n        this.switchTab(tab.dataset.tab);\n      });\n    });\n    this.panel.addEventListener(\"mouseover\", (e) => {\n      const infoIcon = e.target.closest(\".info-icon\");\n      if (infoIcon) {\n        this.showTooltip(infoIcon, e);\n      }\n    });\n    this.panel.addEventListener(\"mouseout\", (e) => {\n      const infoIcon = e.target.closest(\".info-icon\");\n      if (infoIcon) {\n        this.hideTooltip();\n      }\n    });\n    document.addEventListener(\"mousemove\", (e) =>\n      this.updateTooltipPosition(e)\n    );\n    if (this.hourlyChartWrapper) {\n      this.hourlyChartWrapper.addEventListener(\"mousemove\", (e) => this.showChartTooltip(e));\n      this.hourlyChartWrapper.addEventListener(\"mouseout\", () => this.hideTooltip());\n    }\n    if (this.dailyChartWrapper) {\n      this.dailyChartWrapper.addEventListener(\"mousemove\", (e) => this.showChartTooltip(e));\n      this.dailyChartWrapper.addEventListener(\"mouseout\", () => this.hideTooltip());\n    }\n  }\n\n  // ====================================================================\n  // 2. switchTab() - AGORA É O CARREGADOR ON-DEMAND\n  // ====================================================================\n  switchTab(tabName) {\n    this.tabs.forEach((tab) =>\n      tab.classList.toggle(\"active\", tab.dataset.tab === tabName)\n    );\n    this.tabContents.forEach((content) => {\n      content.classList.toggle(\"active\", content.id.includes(tabName));\n    });\n\n    // Lógica do campo de busca (do seu código)\n    if (this.searchContainer && this.searchInput) {\n      if (tabName === \"dashboard\" || tabName === \"history\" || tabName === \"config\") {\n        this.searchContainer.style.display = \"block\";\n        this.searchInput.value = \"\";\n        this.filterContent();\n      } else {\n        this.searchContainer.style.display = \"none\";\n      }\n    }\n\n    // --- CARREGAMENTO ON-DEMAND ---\n    if (tabName === \"dashboard\") this.loadDashboard();\n    if (tabName === \"config\") this.loadTargets();\n    if (tabName === \"history\") this.loadHistoryTargets();\n    \n    // (A lógica de esconder/mostrar paginação foi removida pois\n    // o container da paginação agora está DENTRO da aba 'dashboard-view'\n    // e é escondido/mostrado automaticamente com a aba)\n  }\n\n  // updateTooltipPosition (Sem alteração)\n  updateTooltipPosition(event) {\n    if (!this.tooltip || this.tooltip.style.display !== \"block\") {\n      return;\n    }\n    const padding = 15;\n    let newLeft = event.clientX + padding;\n    let newTop = event.clientY + padding;\n    requestAnimationFrame(() => {\n      const tooltipWidth = this.tooltip.offsetWidth;\n      const tooltipHeight = this.tooltip.offsetHeight;\n      const viewportWidth = window.innerWidth;\n      const viewportHeight = window.innerHeight;\n      if (newLeft + tooltipWidth > viewportWidth) {\n        newLeft = event.clientX - tooltipWidth - padding;\n      }\n      if (newTop + tooltipHeight > viewportHeight) {\n        newTop = event.clientY - tooltipHeight - padding;\n      }\n      if (newLeft < 0) newLeft = padding;\n      if (newTop < 0) newTop = padding;\n      this.tooltip.style.left = `${newLeft}px`;\n      this.tooltip.style.top = `${newTop}px`;\n    });\n  }\n\n  // apiFetch (Versão robusta que havíamos criado)\n  async apiFetch(endpoint, options = {}) {\n    try {\n      const response = await fetch(`${this.apiUrl}${endpoint}`, options);\n      if (!response.ok) {\n        let message = `Erro ${response.status}`;\n        try {\n          const errorData = await response.json();\n          message = errorData?.error || errorData?.message || message;\n        } catch (_) {\n          const text = await response.text();\n          message = text || message;\n        }\n        throw new Error(message);\n      }\n      const text = await response.text();\n      if (!text) {\n          return { success: true, message: \"Operação bem-sucedida (sem retorno)\" };\n      }\n      try {\n           return JSON.parse(text);\n      } catch (e) {\n          console.error(`Resposta inválida (não-JSON) da API para ${endpoint}:`, text);\n          throw new Error(\"A API retornou uma resposta inesperada.\");\n      }\n    } catch (error) {\n      console.error(`❌ Erro na API para ${endpoint}:`, error);\n      return null; \n    }\n  }\n\n  // ====================================================================\n  // 3. loadSettings() - NÃO EXECUTA TESTES\n  // ====================================================================\n  async loadSettings() {\n    const settings = await this.apiFetch(\"/settings\");\n    let refreshRate = 0;\n    if (settings) {\n      this.slowHopThreshold = parseInt(settings.slowHopThreshold, 10);\n      this.slowHopInput.value = this.slowHopThreshold;\n      refreshRate = parseInt(settings.refreshInterval, 10);\n      this.refreshIntervalInput.value = refreshRate;\n      // Retorna as configs para o init()\n      return { refreshRate: refreshRate, slowHopThreshold: this.slowHopThreshold }; \n    } else {\n      this.slowHopInput.value = this.slowHopThreshold;\n      this.refreshIntervalInput.value = 0;\n      return { refreshRate: 0, slowHopThreshold: this.slowHopThreshold };\n    }\n    // A chamada 'runAllTests()' foi REMOVIDA daqui\n  }\n\n  // ====================================================================\n  // 4. saveSettings() - RECARREGA O DASHBOARD\n  // ====================================================================\n  async saveSettings() {\n    // Mostra feedback imediato\n    this.saveSettingsBtn.innerHTML = \"Salvando...\";\n    this.saveSettingsBtn.disabled = true;\n\n    const newRate = parseInt(this.refreshIntervalInput.value, 10);\n    const newThreshold = parseInt(this.slowHopInput.value, 10);\n    if (\n      isNaN(newRate) ||\n      newRate < 0 ||\n      isNaN(newThreshold) ||\n      newThreshold <= 0\n    ) {\n      alert(\"Por favor, insira valores numéricos válidos.\");\n      this.saveSettingsBtn.innerHTML = \"Salvar Configurações\";\n      this.saveSettingsBtn.disabled = false;\n      return;\n    }\n    const response = await this.apiFetch(\"/settings\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        refreshInterval: newRate,\n        slowHopThreshold: newThreshold,\n      }),\n    });\n\n    // Restaura o botão\n    this.saveSettingsBtn.innerHTML = \"Salvar Configurações\";\n    this.saveSettingsBtn.disabled = false;\n\n    if (response) {\n      this.slowHopThreshold = newThreshold;\n      this.startInterval(newRate); // Reinicia o timer\n      alert(\"Configurações salvas no servidor!\");\n      \n      // Chama o 'loadDashboard' para recarregar o esqueleto e disparar os testes\n      this.loadDashboard(); \n    } else {\n      alert(\"Falha ao salvar configurações no servidor.\");\n    }\n  }\n\n  // ====================================================================\n  // 5. startInterval() - CHAMA O ESCALONADOR\n  // ====================================================================\n  startInterval(rateInSeconds) {\n    if (this.refreshIntervalId) {\n      clearInterval(this.refreshIntervalId);\n    }\n    if (rateInSeconds > 0) {\n      this.refreshIntervalId = setInterval(async () => {\n        console.log(\"Monitor: Refresh automático iniciado...\");\n        \n        // Verifica se a aba dashboard está visível\n        const isDashboardActive = this.dashboardView.classList.contains(\"active\");\n        if (!isDashboardActive) {\n            console.log(\"Monitor: Dashboard não está ativo, pulando refresh.\");\n            return; // Pula o refresh se a aba não estiver ativa\n        }\n        \n        // 1. Busca os alvos (rápido, do cache da API)\n        const response = await this.apiFetch(\"/targets\");\n        if (!response || !Array.isArray(response.targets)) {\n            console.log(\"Monitor: Refresh falhou, não foi possível buscar alvos.\");\n            return;\n        }\n        \n        // 2. Executa os testes de forma escalonada (em background)\n        // Não precisamos reconstruir o esqueleto, apenas rodar os testes\n        await this.runAllTests(response.targets, true); // true = isBackgroundRefresh\n\n      }, rateInSeconds * 1000);\n    }\n  }\n\n  // ====================================================================\n  // 6. NOVA FUNÇÃO: loadDashboard()\n  // Carrega o esqueleto, pagina, e DEPOIS chama a função de testes.\n  // ====================================================================\n  async loadDashboard() {\n    if (!this.dashboardGrid) return;\n\n    // Feedback imediato\n    this.dashboardGrid.innerHTML = \"<p>Carregando alvos...</p>\";\n    // Limpa paginação antiga\n    if (this.paginationContainer) this.paginationContainer.innerHTML = \"\";\n\n    const response = await this.apiFetch(\"/targets\"); // Fast from API cache\n    const targets = (response && Array.isArray(response.targets)) ? response.targets : null;\n\n    if (!targets || targets.length === 0) {\n        this.dashboardGrid.innerHTML = \"<p>Nenhum alvo configurado.</p>\";\n        this.applyPagination(); // Isso vai esconder a paginação\n        return;\n    }\n\n    // 1. Construir o esqueleto (cards de \"loading\")\n    this.dashboardGrid.innerHTML = \"\"; // Limpa o \"Carregando alvos...\"\n    targets.forEach((t) => {\n      const safeId = t.target.replace(/[^a-zA-Z0-9]/g, \"\");\n      let cardElement = document.createElement(\"div\");\n      cardElement.id = `card-${safeId}`;\n      this.dashboardGrid.appendChild(cardElement); // Adiciona ao grid\n      cardElement.className = \"card loading\";\n      const iconClass = this.getIconForTarget(t.displayName);\n      // Usamos \"Aguardando...\" em vez de \"Executando...\"\n      cardElement.innerHTML = `<div class=\"card-header\"><div class=\"logo-container\"><i class=\"${iconClass}\"></i><div class=\"loading-circle\"></div></div><div class=\"card-header-text\"><h3>${t.displayName}</h3><small>${t.target}</small></div></div><div style=\"text-align: center; font-size: 12px; color: var(--text-secondary-color); margin-top: 10px;\">Aguardando...</div>`;\n    });\n    \n    // 2. Paginar o esqueleto (RÁPIDO)\n    // Isso mostra a primeira página de cards \"loading\" imediatamente\n    this.currentPage = 1; \n    this.applyPagination(); \n\n    // 3. Disparar a execução dos testes em background (SEM await)\n    // false = não é um refresh de background (controla a flag 'isTestRunInProgress')\n    this.runAllTests(targets, false); \n  }\n\n  // ====================================================================\n  // 7. runAllTests() - O EXECUTOR ESCALONADO\n  // ====================================================================\n  async runAllTests(targets, isBackgroundRefresh = false) {\n    // Se um teste já está rodando E isto NÃO é um refresh, não faça nada.\n    if (this.isTestRunInProgress && !isBackgroundRefresh) {\n      console.log(\"Monitor: Testes já em progresso, ignorando nova chamada.\");\n      return;\n    }\n    \n    this.isTestRunInProgress = true;\n    \n    const queue = [...targets]; \n    console.log(`Monitor: Iniciando fila de ${queue.length} testes...`);\n\n    for (const target of queue) {\n      // Se paramos de rodar (ex: usuário mudou de aba), cancela a fila\n      if (!this.isTestRunInProgress && !isBackgroundRefresh) {\n         console.log(\"Monitor: Execução interrompida.\");\n         break;\n      }\n      \n      // Atualiza o card para \"Executando...\"\n      const safeId = target.target.replace(/[^a-zA-Z0-9]/g, \"\");\n      const cardElement = this.dashboardGrid.querySelector(`#card-${safeId}`);\n      if (cardElement) {\n          const statusText = cardElement.querySelector(\"div[style*='text-align: center']\");\n          if(statusText) statusText.innerHTML = \"Executando...\";\n      }\n\n      target.slowHopThreshold = this.slowHopThreshold;\n\n      const result = await this.apiFetch(\"/traceroute/single\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(target),\n      });\n\n      if (result && result.id) {\n        this.updateSingleCard(result);\n      } else {\n        const errorResult = {\n          id: safeId,\n          displayName: target.displayName,\n          target: target.target,\n          success: false,\n          error: \"Falha na API (timeout?)\",\n          isHighlighted: target.isHighlighted\n        };\n        this.updateSingleCard(errorResult);\n      }\n      \n      // O ESCALONADOR: Aguarda 100ms\n      await new Promise(resolve => setTimeout(resolve, 100)); \n    }\n    \n    console.log(\"Monitor: Carga completa de todos os testes do dashboard.\");\n    this.isTestRunInProgress = false;\n  }\n\n  // getIconForTarget (Sem alteração)\n  getIconForTarget(displayName) {\n    const name = displayName.toLowerCase();\n    if (name.includes(\"google\")) return \"fa-brands fa-google\";\n    if (name.includes(\"facebook\")) return \"fa-brands fa-facebook\";\n    if (name.includes(\"youtube\")) return \"fa-brands fa-youtube\";\n    if (name.includes(\"aws\") || name.includes(\"amazon\")) return \"fa-brands fa-aws\";\n    if (name.includes(\"cloudflare\")) return \"fa-brands fa-cloudflare\";\n    if (name.includes(\"instagram\")) return \"fa-brands fa-instagram\";\n    if (name.includes(\"netflix\")) return \"fa-solid fa-film\"; \n    if (name.includes(\"disney\")) return \"fa-solid fa-wand-magic-sparkles\";\n    if (name.includes(\"uol\")) return \"fa-solid fa-globe\";\n    if (name.includes(\"discord\")) return \"fa-brands fa-discord\";\n    if (name.includes(\"microsoft\")) return \"fa-brands fa-microsoft\";\n    if (name.includes(\"tiktok\")) return \"fa-brands fa-tiktok\";\n    if (name.includes(\"spotify\")) return \"fa-brands fa-spotify\";\n    if (name.includes(\"prime video\")) return \"fa-brands fa-amazon\";\n    if (name.includes(\"akamai\")) return \"fa-solid fa-globe\";\n    return \"fa-solid fa-network-wired\";\n  }\n\n  // updateSingleCard (Sem alteração)\n  updateSingleCard(result) {\n    const cardElement = this.dashboardGrid.querySelector(`#card-${result.id}`);\n    if (!cardElement) return;\n    if (result.isHighlighted) {\n      cardElement.classList.add(\"highlighted\");\n    } else {\n      cardElement.classList.remove(\"highlighted\");\n    }\n    const previous = this.previousResults[result.id];\n    let hopChange = 0;\n    if (\n      previous &&\n      previous.success &&\n      result.success &&\n      previous.data &&\n      result.data\n    ) {\n      hopChange = result.data.totalHops - previous.data.totalHops;\n    }\n    this.previousResults[result.id] = result;\n    cardElement.classList.remove(\"loading\");\n    const iconClass = this.getIconForTarget(result.displayName);\n    let cardHTML = \"\";\n    if (result.success && result.data) {\n      const data = result.data;\n      this.tooltipData[result.id] = { ...data, hopChange };\n      let hopChangeIndicator = \"\";\n      if (hopChange > 0) {\n        hopChangeIndicator = `<span class=\"hop-change increase\"><i class=\"fa-solid fa-arrow-up\"></i></span>`;\n      } else if (hopChange < 0) {\n        hopChangeIndicator = `<span class=\"hop-change decrease\"><i class=\"fa-solid fa-arrow-down\"></i></span>`;\n      }\n      const analysis = result.analysis;\n      let analysisHTML = \"\";\n      if (analysis) {\n        const formatChange = (change) =>\n          change === null ? \"N/A\" : change > 0 ? `+${change}` : change;\n        const routeChangedText = analysis.routeChanged\n          ? `<span class=\"value danger\">Sim</span>`\n          : '<span class=\"value\">Não</span>';\n        analysisHTML = `<div class=\"analysis-group\"><div class=\"analysis-item\"><span>Mudança de Rota:</span> ${routeChangedText}</div><div class=\"analysis-item\"><span>Variação Saltos (24h):</span> <span class=\"value\">${formatChange(\n          analysis.hopChangeD\n        )}</span></div><div class=\"analysis-item\"><span>Variação Saltos (7d):</span> <span class=\"value\">${formatChange(\n          analysis.hopChange7D\n        )}</span></div></div>`;\n      }\n      cardHTML = `<div class=\"card-header\"><div class=\"logo-container\"><i class=\"${iconClass}\"></i></div><div class=\"card-header-text\"><h3>${result.displayName\n        }</h3><small>${result.target\n        }</small></div><div class=\"info-icon\" data-id=\"${result.id\n        }\"><i class=\"fa-solid fa-info\"></i></div></div><div class=\"card-body\"><div class=\"metric-group\"><div class=\"metric\"><div class=\"value\">${data.totalHops\n        }${hopChangeIndicator}</div><div class=\"label\">Saltos</div></div><div class=\"metric\"><div class=\"value\">${data.slowHopsCount\n        }</div><div class=\"label\">> ${this.slowHopThreshold\n        }ms</div></div></div><div class=\"metric-group latency-group\"><div class=\"metric\"><div class=\"value\">${data.fastestHop.toFixed(\n          3\n        )}</div><div class=\"label\">Rápido (ms)</div></div><div class=\"metric\"><div class=\"value\">${data.slowestHop.toFixed(\n          3\n        )}</div><div class=\"label\">Lento (ms)</div></div></div></div>${analysisHTML}`;\n    } else {\n      cardHTML = `<div class=\"card-header\"><div class=\"logo-container\"><i class=\"${iconClass}\"></i></div><div class=\"card-header-text\"><h3>${result.displayName\n        }</h3><small>${result.target\n        }</small></div></div><div style=\"text-align: center; font-size: 12px; color: #e54646; margin-top: 10px;\">Falha: ${result.error || \"Dados inválidos\"\n        }</div>`;\n    }\n    cardElement.innerHTML = cardHTML;\n  }\n\n  // ====================================================================\n  // 8. loadTargets() - ON-DEMAND COM FEEDBACK\n  // ====================================================================\n  async loadTargets() {\n    if (!this.targetsList) return;\n    this.targetsList.innerHTML = \"<p>Carregando alvos...</p>\"; // Feedback imediato\n\n    const response = await this.apiFetch(\"/targets\");\n    const targets = (response && Array.isArray(response.targets)) ? response.targets : null;\n\n    if (!targets) {\n      this.targetsList.innerHTML = \"<p>Erro ao carregar alvos.</p>\";\n      return;\n    }\n    if (targets.length === 0) {\n      this.targetsList.innerHTML = \"<p>Nenhum alvo configurado.</p>\";\n      return;\n    }\n    let tableHTML = `<table><thead><tr><th>Nome</th><th>Alvo</th><th style=\"text-align: right;\">Ações</th></tr></thead><tbody>`;\n    targets.forEach((t) => {\n      const targetInfo = JSON.stringify(t).replace(/\"/g, \"'\");\n      tableHTML += `<tr data-target-info=\"${targetInfo}\"><td>${t.displayName}</td><td>${t.target}</td><td class=\"actions\"><button class=\"edit-btn\"><i class=\"fa-solid fa-pencil\"></i></button><button class=\"delete-btn\" data-id=\"${t.id}\"><i class=\"fa-solid fa-trash-can\"></i></button></td></tr>`;\n    });\n    tableHTML += \"</tbody></table>\";\n    this.targetsList.innerHTML = tableHTML;\n    \n    // Anexa os listeners DEPOIS de criar a tabela\n    this.targetsList.querySelectorAll(\".delete-btn\").forEach((btn) => {\n      btn.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n        this.deleteTarget(e.currentTarget.dataset.id);\n      });\n    });\n    this.targetsList.querySelectorAll(\".edit-btn\").forEach((btn) => {\n      btn.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n        const targetJson = e.currentTarget\n          .closest(\"tr\")\n          .dataset.targetInfo.replace(/'/g, '\"');\n        const targetInfo = JSON.parse(targetJson);\n        this.setEditMode(targetInfo);\n      });\n    });\n  }\n\n  // setEditMode (Sem alteração)\n  setEditMode(target) {\n    this.editMode.active = true;\n    this.editMode.targetId = target.id;\n    this.displayNameInput.value = target.displayName;\n    this.targetInput.value = target.target;\n    this.highlightInput.checked = target.isHighlighted;\n    this.addTargetBtn.innerHTML = '<i class=\"fa-solid fa-save\"></i> Salvar';\n    this.cancelEditBtn.style.display = \"inline-block\";\n    this.displayNameInput.focus();\n  }\n\n  // cancelEditMode (Sem alteração)\n  cancelEditMode() {\n    this.editMode.active = false;\n    this.editMode.targetId = null;\n    this.displayNameInput.value = \"\";\n    this.targetInput.value = \"\";\n    this.highlightInput.checked = false;\n    this.addTargetBtn.innerHTML = '<i class=\"fa-solid fa-plus\"></i> Adicionar';\n    this.cancelEditBtn.style.display = \"none\";\n  }\n\n  // addTarget (Sem alteração)\n  async addTarget() {\n    const displayName = this.displayNameInput.value.trim();\n    const target = this.targetInput.value.trim();\n    const isHighlighted = this.highlightInput.checked;\n    if (!displayName || !target) {\n      alert(\"Preencha ambos os campos.\");\n      return;\n    }\n    const response = await this.apiFetch(\"/targets\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ displayName, target, isHighlighted }),\n    });\n    if (response) {\n      this.cancelEditMode();\n      this.loadTargets();\n    }\n  }\n\n  // saveTargetChanges (Sem alteração)\n  async saveTargetChanges() {\n    const displayName = this.displayNameInput.value.trim();\n    const target = this.targetInput.value.trim();\n    const isHighlighted = this.highlightInput.checked;\n    if (!displayName || !target) {\n      alert(\"Preencha ambos os campos.\");\n      return;\n    }\n    const response = await this.apiFetch(`/targets/${this.editMode.targetId}`, {\n      method: \"PUT\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ displayName, target, isHighlighted }),\n    });\n    if (response) {\n      this.cancelEditMode();\n      this.loadTargets();\n    }\n  }\n\n  // deleteTarget (Sem alteração)\n  async deleteTarget(id) {\n    if (confirm(\"Tem certeza que deseja excluir este alvo?\")) {\n      const response = await this.apiFetch(`/targets/${id}`, {\n        method: \"DELETE\",\n      });\n      if (response) this.loadTargets();\n    }\n  }\n\n  // runSpotTest (Sem alteração)\n  async runSpotTest() {\n    const target = this.spotTestTargetInput.value.trim();\n    if (!target) {\n      alert(\"Por favor, insira um alvo.\");\n      return;\n    }\n    this.spotTestResultPre.innerHTML = \"Executando teste...\";\n    const body = {\n      target: target,\n      displayName: target,\n      id: target.replace(/[^a-zA-Z0-9]/g, \"\"),\n      slowHopThreshold: this.slowHopThreshold,\n    };\n    const result = await this.apiFetch(\"/traceroute/single\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(body),\n    });\n    if (result && result.success) {\n      let output = `--- Resultado para ${target} ---\\n\\n`;\n      const hopWidth = 5;\n      const latencyWidth = 15;\n      let headerHop = \"Salto\".padStart(hopWidth);\n      let headerLatency = \"Latência (ms)\".padStart(latencyWidth);\n      let headerIp = \"IP\";\n      output += `${headerHop} | ${headerLatency} | ${headerIp}\\n`;\n      let lineHop = \"-\".repeat(hopWidth);\n      let lineLatency = \"-\".repeat(latencyWidth);\n      let lineIp = \"-\".repeat(25);\n      output += `${lineHop}-|-{lineLatency}-|-${lineIp}\\n`;\n      result.data.detailedHops.forEach((hop) => {\n        let hopStr = String(hop.hop).padStart(hopWidth);\n        let latencyStr = hop.latency.toFixed(2).padStart(latencyWidth);\n        output += `${hopStr} | ${latencyStr} | ${hop.ip}\\n`;\n      });\n      this.spotTestResultPre.innerHTML = output;\n    } else {\n      this.spotTestResultPre.innerHTML = `Falha no teste para ${target}.\\nErro: ${result ? result.error : \"Desconhecido\"\n        }`;\n    }\n  }\n\n  // filterContent (Do seu código, com 'applyPagination')\n  filterContent() {\n    if (!this.searchInput) return;\n    const filterText = this.searchInput.value.toLowerCase();\n    let activeTabName = null;\n    this.tabs.forEach(tab => {\n      if (tab.classList.contains(\"active\")) {\n        activeTabName = tab.dataset.tab;\n      }\n    });\n\n    if (activeTabName === \"dashboard\") {\n      this.currentPage = 1; // Reseta a página ao filtrar\n      this.applyPagination(); // Chama a nova função de paginação\n    } else if (activeTabName === \"history\") {\n      this.filterHistory(filterText);\n    } else if (activeTabName === \"config\") {\n      this.filterConfig(filterText);\n    }\n  }\n  \n  // filterHistory (Do seu código, sem alteração)\n  filterHistory(filterText) {\n    if (!this.historyTargetSelector) return;\n    const buttons = this.historyTargetSelector.querySelectorAll(\".target-btn\");\n    buttons.forEach(btn => {\n      const displayName = btn.textContent.toLowerCase();\n      if (displayName.includes(filterText)) {\n        btn.style.display = \"\";\n      } else {\n        btn.style.display = \"none\";\n      }\n    });\n  }\n\n  // filterConfig (Do seu código, sem alteração)\n  filterConfig(filterText) {\n    if (!this.targetsList) return;\n    const rows = this.targetsList.querySelectorAll(\"tbody tr\");\n    rows.forEach(row => {\n      const displayName = row.cells[0]?.textContent.toLowerCase() || \"\";\n      const targetName = row.cells[1]?.textContent.toLowerCase() || \"\";\n      if (displayName.includes(filterText) || targetName.includes(filterText)) {\n        row.style.display = \"\";\n      } else {\n        row.style.display = \"none\";\n      }\n    });\n  }\n\n  // --- Funções de Paginação (Do seu código, sem alteração) ---\n  \n  applyPagination() {\n    if (!this.dashboardGrid || !this.paginationContainer) return;\n    const allCards = Array.from(this.dashboardGrid.querySelectorAll('.card'));\n    const filterText = this.searchInput ? this.searchInput.value.toLowerCase() : \"\";\n\n    const filteredCards = allCards.filter(card => {\n      if (filterText === \"\") return true;\n      const displayName = card.querySelector(\".card-header-text h3\")?.textContent.toLowerCase() || \"\";\n      const targetName = card.querySelector(\".card-header-text small\")?.textContent.toLowerCase() || \"\";\n      return displayName.includes(filterText) || targetName.includes(filterText);\n    });\n\n    this.renderPagination(filteredCards.length);\n\n    const totalPages = Math.ceil(filteredCards.length / this.itemsPerPage);\n    if (this.currentPage > totalPages && totalPages > 0) {\n      this.currentPage = totalPages;\n    }\n\n    const startIndex = (this.currentPage - 1) * this.itemsPerPage;\n    const endIndex = startIndex + this.itemsPerPage;\n\n    allCards.forEach(card => card.style.display = 'none');\n\n    filteredCards.forEach((card, index) => {\n      if (index >= startIndex && index < endIndex) {\n        card.style.display = 'flex';\n      }\n    });\n  }\n\n  renderPagination(totalItems) {\n    if (!this.paginationContainer) return;\n    const totalPages = Math.ceil(totalItems / this.itemsPerPage);\n\n    this.paginationContainer.innerHTML = '';\n    if (totalPages <= 1) {\n      this.paginationContainer.style.display = 'none';\n      return;\n    }\n\n    this.paginationContainer.style.display = 'flex';\n\n    const prevBtn = document.createElement('button');\n    prevBtn.className = 'pagination-btn';\n    prevBtn.innerHTML = '<i class=\"fa-solid fa-chevron-left\"></i>';\n    prevBtn.disabled = (this.currentPage === 1);\n    prevBtn.onclick = () => {\n      if (this.currentPage > 1) {\n        this.currentPage--;\n        this.applyPagination();\n      }\n    };\n    this.paginationContainer.appendChild(prevBtn);\n\n    for (let i = 1; i <= totalPages; i++) {\n      const pageBtn = document.createElement('button');\n      pageBtn.className = 'pagination-btn';\n      pageBtn.textContent = i;\n      if (i === this.currentPage) {\n        pageBtn.classList.add('active');\n      }\n      pageBtn.onclick = () => {\n        if (this.currentPage !== i) {\n          this.currentPage = i;\n          this.applyPagination();\n        }\n      };\n      this.paginationContainer.appendChild(pageBtn);\n    }\n\n    const nextBtn = document.createElement('button');\n    nextBtn.className = 'pagination-btn';\n    nextBtn.innerHTML = '<i class=\"fa-solid fa-chevron-right\"></i>';\n    nextBtn.disabled = (this.currentPage === totalPages);\n    nextBtn.onclick = () => {\n      if (this.currentPage < totalPages) {\n        this.currentPage++;\n        this.applyPagination();\n      }\n    };\n    this.paginationContainer.appendChild(nextBtn);\n  }\n  // --- Fim Paginação ---\n\n  // showTooltip (Sem alteração)\n  showTooltip(element, event) {\n    if (!this.tooltip) return;\n    const id = element.dataset.id;\n    const data = this.tooltipData[id];\n    if (!data || !data.detailedHops || data.detailedHops.length === 0) {\n      this.tooltip.innerHTML = \"<span>Nenhum dado de salto disponível.</span>\";\n    } else {\n      let tooltipContent =\n        \"Salto | Latência (ms) | IP\\n-----------------------------------\\n\";\n      data.detailedHops.forEach((hop) => {\n        const hopLine = `${String(hop.hop).padStart(5)} | ${hop.latency\n          .toFixed(2)\n          .padStart(12)} | ${hop.ip}\\n`;\n        tooltipContent += hop.isSlow ?\n          `<span class=\"slow-hop\">${hopLine}</span>` :\n          hopLine;\n      });\n      if (data.hopChange && data.hopChange !== 0) {\n        const sign = data.hopChange > 0 ? \"+\" : \"\";\n        const changeClass = data.hopChange > 0 ? \"increase\" : \"decrease\";\n        const variationText = `Variação: ${sign}${data.hopChange} salto(s)`;\n        tooltipContent += `\\n<span class=\"hop-change ${changeClass}\">${variationText}</span>`;\n      }\n      this.tooltip.innerHTML = tooltipContent;\n    }\n    this.tooltip.style.display = \"block\";\n    this.updateTooltipPosition(event);\n  }\n\n  // hideTooltip (Sem alteração)\n  hideTooltip() {\n    if (!this.tooltip) return;\n    this.tooltip.style.display = \"none\";\n  }\n\n  // showChartTooltip (Sem alteração)\n  showChartTooltip(event) {\n    if (!this.tooltip) return;\n    const target = event.target;\n    let tooltipText = null;\n    if ((target.tagName === 'rect' || target.tagName === 'circle') && target.querySelector('title')) {\n      tooltipText = target.querySelector('title').textContent;\n    }\n    if (tooltipText) {\n      if (this.tooltip.innerHTML !== `<span>${tooltipText}</span>`) {\n        this.tooltip.innerHTML = `<span>${tooltipText}</span>`;\n      }\n      this.tooltip.style.display = \"block\";\n    } else {\n      this.hideTooltip();\n    }\n  }\n\n  // ====================================================================\n  // 9. loadHistoryTargets() - ON-DEMAND (Lógica de merge de nomes)\n  // ====================================================================\n  async loadHistoryTargets() {\n    this.historyTargetSelector.innerHTML = \"Carregando...\";\n    this.hourlyChart = null;\n    this.dailyChart = null;\n    const chartContainer = this.panel.querySelector(\n      \"#history-view .chart-container\"\n    );\n    if (chartContainer) chartContainer.style.display = \"none\";\n\n    // 1. Busca os alvos atuais (rápido, cache da API)\n    const targetsResponse = await this.apiFetch(\"/targets\");\n    const currentTargets = (targetsResponse && Array.isArray(targetsResponse.targets)) ? targetsResponse.targets : [];\n\n    // 2. Filtra APENAS os que estão marcados para histórico\n    const highlightedTargets = currentTargets.filter(\n      (target) => target.isHighlighted === true\n    );\n    \n    if (highlightedTargets.length === 0) {\n      this.historyTargetSelector.innerHTML = \"Nenhum alvo está marcado para histórico na aba de Configuração.\";\n      return;\n    }\n\n    // 3. Renderiza os botões (on-demand)\n    this.historyTargetSelector.innerHTML = \"\";\n    highlightedTargets.forEach((target) => {\n      const btn = document.createElement(\"button\");\n      btn.className = \"target-btn\";\n      btn.textContent = target.displayName; // Usa o nome atual\n      btn.dataset.targetId = target.id;     // Usa o ID/target atual\n\n      btn.addEventListener(\"click\", () => {\n        this.historyTargetSelector\n          .querySelectorAll(\".target-btn\")\n          .forEach((b) => b.classList.remove(\"active\"));\n        btn.classList.add(\"active\");\n        this.loadHistoryForTarget(target.id); // Carrega o gráfico ao clicar\n      });\n      this.historyTargetSelector.appendChild(btn);\n    });\n    \n    // Removemos o auto-click. O usuário escolhe qual gráfico carregar.\n  }\n\n\n  // ====================================================================\n  // 10. loadHistoryForTarget() - ON-DEMAND COM FEEDBACK\n  // ====================================================================\n  async loadHistoryForTarget(targetId) {\n    this.hourlyChart = null;\n    this.dailyChart = null;\n    const chartContainer = this.panel.querySelector(\n      \"#history-view .chart-container\"\n    );\n    if (!chartContainer) return;\n    \n    chartContainer.style.display = \"grid\"; // Mostra o container dos gráficos\n\n    // Feedback de carregamento\n    const hourlyEl = this.panel.querySelector(\"#hourly-chart\");\n    const dailyEl = this.panel.querySelector(\"#daily-chart\");\n    if(hourlyEl) hourlyEl.parentElement.innerHTML = `<h3>Carregando...</h3><div id=\"hourly-chart\"></div>`;\n    if(dailyEl) dailyEl.parentElement.innerHTML = `<h3>Carregando...</h3><div id=\"daily-chart\"></div>`;\n\n    // Busca os dados\n    const hourlyResponse = await this.apiFetch(\n      `/history/charts/${targetId}/hourly`\n    );\n    const dailyResponse = await this.apiFetch(\n      `/history/charts/${targetId}/daily`\n    );\n\n    let hourlyError = !hourlyResponse || !hourlyResponse.success;\n    let dailyError = !dailyResponse || !dailyResponse.success;\n\n    // Renderiza gráfico horário\n    const hourlyContainer = this.panel.querySelector(\"#hourly-chart\")?.parentElement;\n    if (hourlyContainer) {\n        hourlyContainer.innerHTML = `\n          <h3>${hourlyResponse?.title || \"Médias por Hora (24h)\"}</h3>\n          <div id=\"hourly-chart\">\n            ${hourlyError ? \n              `<p style=\"color:#ffc107;\">${hourlyResponse?.error || 'Falha ao carregar'}</p>` : \n              this.createSVGChart(hourlyResponse.chartData, \"hourly\")}\n          </div>\n        `;\n    }\n\n    // Renderiza gráfico diário\n    const dailyContainer = this.panel.querySelector(\"#daily-chart\")?.parentElement;\n     if (dailyContainer) {\n        dailyContainer.innerHTML = `\n          <h3>${dailyResponse?.title || \"Métricas por Dia (7d)\"}</h3>\n          <div id=\"daily-chart\">\n             ${dailyError ? \n              `<p style=\"color:#ffc107;\">${dailyResponse?.error || 'Falha ao carregar'}</p>` : \n              this.createSVGChart(dailyResponse.chartData, \"daily\")}\n          </div>\n        `;\n    }\n\n    // Re-anexa listeners de tooltip\n    this.hourlyChartWrapper = this.panel.querySelector(\"#hourly-chart\");\n    this.dailyChartWrapper = this.panel.querySelector(\"#daily-chart\");\n    if (this.hourlyChartWrapper) {\n      this.hourlyChartWrapper.addEventListener(\"mousemove\", (e) => this.showChartTooltip(e));\n      this.hourlyChartWrapper.addEventListener(\"mouseout\", () => this.hideTooltip());\n    }\n    if (this.dailyChartWrapper) {\n      this.dailyChartWrapper.addEventListener(\"mousemove\", (e) => this.showChartTooltip(e));\n      this.dailyChartWrapper.addEventListener(\"mouseout\", () => this.hideTooltip());\n    }\n  }\n\n  // createSVGChart (Sem alteração)\n  createSVGChart(chartData, type) {\n    if (!chartData || !chartData.labels || !chartData.datasets) {\n      return '<p style=\"color: #FFFFFF;\">Sem dados para exibir</p>';\n    }\n    if (type === \"hourly\") {\n      return this.createLineChart(chartData, type);\n    } else {\n      return this.createBarChart(chartData, type);\n    }\n  }\n\n  // createLineChart (Sem alteração)\n  createLineChart(chartData, type) {\n    const width = 520;\n    const height = 320;\n    const padding = { top: 20, right: 50, bottom: 70, left: 70 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    const labels = chartData.labels;\n    const datasets = chartData.datasets;\n    let allValues = [];\n    datasets.forEach((dataset) => {\n      if (dataset.data) {\n        allValues = allValues.concat(\n          dataset.data.filter((v) => v !== null && v !== undefined && !isNaN(v))\n        );\n      }\n    });\n    if (allValues.length === 0) {\n      return '<p style=\"color: #FFFFFF;\">Sem dados válidos para exibir</p>';\n    }\n    const maxValue = Math.max(...allValues);\n    const minValue = Math.min(...allValues);\n    const valueRange = Math.max(maxValue - minValue, 1);\n    let svg = `<svg width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\" style=\"background: transparent; font-family: inherit;\">`;\n    const gridLines = 5;\n    for (let i = 0; i <= gridLines; i++) {\n      const y = padding.top + (chartHeight * i) / gridLines;\n      svg += `<line x1=\"${padding.left}\" y1=\"${y}\" x2=\"${padding.left + chartWidth\n        }\" y2=\"${y}\" stroke=\"rgba(255, 255, 255, 0.15)\" stroke-width=\"0.5\"/>`;\n      const value = maxValue - (valueRange * i) / gridLines;\n      svg += `<text x=\"${padding.left - 10}\" y=\"${y + 4\n        }\" fill=\"#FFFFFF\" text-anchor=\"end\" font-size=\"11\">${value.toFixed(\n          0\n        )}</text>`;\n    }\n    for (let i = 0; i < labels.length; i++) {\n      const x =\n        labels.length > 1\n          ? padding.left + (i * chartWidth) / (labels.length - 1)\n          : padding.left + chartWidth / 2;\n      svg += `<line x1=\"${x}\" y1=\"${padding.top}\" x2=\"${x}\" y2=\"${padding.top + chartHeight\n        }\" stroke=\"rgba(255, 255, 255, 0.15)\" stroke-width=\"0.2\" opacity=\"0.5\"/>`;\n    }\n    svg += `<line x1=\"${padding.left}\" y1=\"${padding.top}\" x2=\"${padding.left\n      }\" y2=\"${padding.top + chartHeight}\" stroke=\"#FFFFFF\" stroke-width=\"1\"/>`;\n    svg += `<line x1=\"${padding.left}\" y1=\"${padding.top + chartHeight}\" x2=\"${padding.left + chartWidth\n      }\" y2=\"${padding.top + chartHeight}\" stroke=\"#FFFFFF\" stroke-width=\"1\"/>`;\n    const colors = [\"#e54646\", \"#28a745\", \"#33a2e5\", \"#ffc107\", \"#6f42c1\"];\n    datasets.forEach((dataset, datasetIndex) => {\n      const color =\n        dataset.backgroundColor || colors[datasetIndex % colors.length];\n      let pathData = \"\";\n      let points = [];\n      labels.forEach((label, index) => {\n        const value = dataset.data[index];\n        if (value !== null && value !== undefined && !isNaN(value)) {\n          const x =\n            labels.length > 1\n              ? padding.left + (index * chartWidth) / (labels.length - 1)\n              : padding.left + chartWidth / 2;\n          const normalizedValue = Math.max((value - minValue) / valueRange, 0);\n          const y = padding.top + chartHeight - normalizedValue * chartHeight;\n          points.push({ x, y, value, label });\n          if (pathData === \"\") {\n            pathData = `M ${x} ${y}`;\n          } else {\n            pathData += ` L ${x} ${y}`;\n          }\n        }\n      });\n      if (pathData) {\n        svg += `<path d=\"${pathData}\" stroke=\"${color}\" stroke-width=\"2\" fill=\"none\" opacity=\"0.8\"/>`;\n      }\n      points.forEach((point) => {\n        svg += `<circle cx=\"${point.x}\" cy=\"${point.y\n          }\" r=\"4\" fill=\"${color}\" opacity=\"0.9\" stroke=\"white\" stroke-width=\"1\">\n                       <title>Média da ${dataset.label || \"Dados\"} na hora ${point.label\n          }: ${point.value}${dataset.label && dataset.label.includes(\"Latência\") ? \"ms\" : \"\"\n          }</title>\n                     </circle>`;\n      });\n    });\n    labels.forEach((label, index) => {\n      if (index % 2 === 0) {\n        const x =\n          labels.length > 1\n            ? padding.left + (index * chartWidth) / (labels.length - 1)\n            : padding.left + chartWidth / 2;\n        const y = padding.top + chartHeight + 20;\n        svg += `<text x=\"${x}\" y=\"${y}\" fill=\"#FFFFFF\" text-anchor=\"middle\" font-size=\"10\">${label}</text>`;\n      }\n    });\n    let legendStartY = height * 0.95;\n    const legendItemWidth = Math.min(200, chartWidth / datasets.length);\n    datasets.forEach((dataset, index) => {\n      const legendX = padding.left + index * legendItemWidth;\n      const color = dataset.backgroundColor || colors[index % colors.length];\n      svg += `<circle cx=\"${legendX + 6}\" cy=\"${legendStartY}\" r=\"6\" fill=\"${color}\" opacity=\"0.8\"/>`;\n      svg += `<text x=\"${legendX + 18\n        }\" y=\"${legendStartY + 4}\" fill=\"#FFFFFF\" font-size=\"11\" font-weight=\"bold\">${dataset.label || `Dataset ${index + 1}`\n        }</text>`;\n    });\n    svg += \"</svg>\";\n    return svg;\n  }\n\n  // createBarChart (Sem alteração)\n  createBarChart(chartData, type) {\n    const width = 520;\n    const height = 320;\n    const padding = { top: 20, right: 50, bottom: 70, left: 70 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    const labels = chartData.labels;\n    const datasets = chartData.datasets;\n    let allValues = [];\n    datasets.forEach((dataset) => {\n      if (dataset.data) {\n        allValues = allValues.concat(\n          dataset.data.filter((v) => v !== null && v !== undefined && !isNaN(v))\n        );\n      }\n    });\n    if (allValues.length === 0) {\n      return '<p style=\"color: #FFFFFF;\">Sem dados válidos para exibir</p>';\n    }\n    const maxValue = Math.max(...allValues);\n    const minValue = Math.min(...allValues);\n    const valueRange = Math.max(maxValue - minValue, 1);\n    const barGroupWidth = chartWidth / labels.length;\n    const barWidth = Math.max(barGroupWidth / datasets.length - 2, 8);\n    let svg = `<svg width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\" style=\"background: transparent; font-family: inherit;\">`;\n    const gridLines = 5;\n    for (let i = 0; i <= gridLines; i++) {\n      const y = padding.top + (chartHeight * i) / gridLines;\n      svg += `<line x1=\"${padding.left}\" y1=\"${y}\" x2=\"${padding.left + chartWidth\n        }\" y2=\"${y}\" stroke=\"rgba(255, 255, 255, 0.15)\" stroke-width=\"0.5\"/>`;\n      const value = maxValue - (valueRange * i) / gridLines;\n      svg += `<text x=\"${padding.left - 10}\" y=\"${y + 4\n        }\" fill=\"#FFFFFF\" text-anchor=\"end\" font-size=\"11\">${value.toFixed(\n          0\n        )}</text>`;\n    }\n    for (let i = 0; i < labels.length; i++) {\n      const x = padding.left + i * barGroupWidth + barGroupWidth / 2;\n      svg += `<line x1=\"${x}\" y1=\"${padding.top}\" x2=\"${x}\" y2=\"${padding.top + chartHeight\n        }\" stroke=\"rgba(255, 255, 255, 0.15)\" stroke-width=\"0.2\" opacity=\"0.5\"/>`;\n    }\n    svg += `<line x1=\"${padding.left}\" y1=\"${padding.top}\" x2=\"${padding.left\n      }\" y2=\"${padding.top + chartHeight}\" stroke=\"#FFFFFF\" stroke-width=\"1\"/>`;\n    svg += `<line x1=\"${padding.left}\" y1=\"${padding.top + chartHeight}\" x2=\"${padding.left + chartWidth\n      }\" y2=\"${padding.top + chartHeight}\" stroke=\"#FFFFFF\" stroke-width=\"1\"/>`;\n    labels.forEach((label, index) => {\n      const baseX = padding.left + index * barGroupWidth;\n      datasets.forEach((dataset, datasetIndex) => {\n        const value = dataset.data[index];\n        if (value !== null && value !== undefined && !isNaN(value)) {\n          const normalizedValue = Math.max((value - minValue) / valueRange, 0);\n          const barHeight = normalizedValue * chartHeight;\n          const x =\n            baseX +\n            datasetIndex * (barWidth + 2) +\n            (barGroupWidth - datasets.length * (barWidth + 2)) / 2;\n          const y = padding.top + chartHeight - barHeight;\n          const colors = [\n            \"#33a2e5\",\n            \"#e54646\",\n            \"#28a745\",\n            \"#ffc107\",\n            \"#6f42c1\",\n          ];\n          const color =\n            dataset.backgroundColor || colors[datasetIndex % colors.length];\n          const radius = 8;\n          const titleText = `${dataset.label || \"Dados\"}: ${value}${dataset.label && dataset.label.includes(\"Latência\") ? \"ms\" : \"\"\n            }`;\n          svg += `<rect x=\"${x}\" y=\"${y}\" width=\"${barWidth}\" height=\"${barHeight}\" fill=\"${color}\" fill-opacity=\"0.8\"\n                               rx=\"${radius}\" ry=\"${radius}\" \n                               style=\"transition: opacity 0.2s;\">\n                               <title>${titleText}</title>\n                             </rect>`;\n        }\n      });\n    });\n    labels.forEach((label, index) => {\n      const step = (type === 'daily') ? 1 : 2;\n      if (index % step === 0) {\n        const x = padding.left + index * barGroupWidth + barGroupWidth / 2;\n        const y = padding.top + chartHeight + 20;\n        // const parts = label.split(\"-\"); // API agora manda DD/MM\n        // const displayLabel = (type === \"daily\" && parts.length === 3)\n        //   ? `${parts[2]}/${parts[1]}`\n        //   : label;\n        svg += `<text x=\"${x}\" y=\"${y}\" fill=\"#FFFFFF\" text-anchor=\"middle\" font-size=\"10\">${label}</text>`;\n      }\n    });\n    let legendStartY = height * 0.95;\n    const legendItemWidth = Math.min(200, chartWidth / datasets.length);\n    datasets.forEach((dataset, index) => {\n      const legendX = padding.left + index * legendItemWidth;\n      const colors = [\"#33a2e5\", \"#e54646\", \"#28a745\", \"#ffc107\", \"#6f42c1\"];\n      const color = dataset.backgroundColor || colors[index % colors.length];\n      svg += `<circle cx=\"${legendX + 6}\" cy=\"${legendStartY}\" r=\"6\" fill=\"${color}\" opacity=\"0.8\"/>`;\n      svg += `<text x=\"${legendX + 18\n        }\" y=\"${legendStartY + 4}\" fill=\"#FFFFFF\" font-size=\"11\" font-weight=\"bold\">${\n        dataset.label || `Dataset ${index + 1}`\n        }</text>`;\n    });\n    svg += \"</svg>\";\n    return svg;\n  }\n} // Fim da classe TracerouteMonitor\n\nwindow.startTracerouteMonitor = function (anchorElement) {\n  const panelElement = anchorElement.closest(\".main-container\");\n  if (panelElement && !panelElement.dataset.initialized) {\n    panelElement.dataset.initialized = \"true\";\n    const monitor = new TracerouteMonitor(panelElement);\n    monitor.init();\n  }\n};",
        "overflow": "visible",
        "panelupdateOnMount": true,
        "reduceOptions": {
          "calcs": [
            "lastNotNull",
            "last",
            "firstNotNull",
            "first",
            "min",
            "max",
            "mean",
            "median",
            "sum",
            "count",
            "range",
            "delta",
            "step",
            "diff",
            "logmin",
            "allIsZero",
            "allIsNull",
            "diffperc"
          ]
        },
        "renderOnMount": true,
        "rootCSS": ":root {\n  --primary-bg: transparent;\n  --panel-bg: #1c1c1e;\n  --text-color: #d8d9da;\n  --text-secondary-color: #8e8e8e;\n  --primary-accent: #33a2e5;\n  --border-color: #323236;\n  --shadow-color: rgba(0, 0, 0, 0.3);\n  --color-increase: #e54646;\n  --color-decrease: #33a2e5;\n}",
        "useGrafanaScrollbar": true
      },
      "pluginVersion": "2.2.1",
      "type": "gapit-htmlgraphics-panel"
    }
  ],
  "refresh": "",
  "schemaVersion": 42,
  "tags": [],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "MONITORAMENTO DE SALTOS - VERSÃO FINAL v2",
  "uid": "adk7zhg",
  "version": 3,
  "weekStart": ""
}